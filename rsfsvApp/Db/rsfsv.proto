#swee---------------------------------------------------------------------
# Title      : Rohde & Schwarz FSV Signal Analyzer Epics Protocol File
# Project    :
#---------------------------------------------------------------------
# File       : rsfsv.proto
# Author     : Vitor Finotti Ferreira  <vfinotti@finotti-Inspiron-7520>
# Company    : Brazilian Synchrotron Light Laboratory, LNLS/CNPEM
# Created    : 2016-04-05
# Last update: 2016-04-05
# Platform   :
# Standard   : Python 3.4
#---------------------------------------------------------------------
# Description:
#
# Defines protocol to use the device as a StreamDevice IOC in EPICS
#
#---------------------------------------------------------------------
# Copyright (c) 2016 Brazilian Synchrotron Light Laboratory, LNLS/CNPEM
#
# This program is free software: you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public License
# as published by the Free Software Foundation, either version 3 of
# the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this program. If not, see
# <http://www.gnu.org/licenses/>.
#---------------------------------------------------------------------
# Revisions  :
# Date        Version  Author          Description
# 2016-apr-05 1.0      vfinotti        Created
#---------------------------------------------------------------------

######################################################################
#
# Variable declaration
#
GLOBAL_TIMEOUT = 5000;

######################################################################
#
# Communication setup
#
OutTerminator = CR LF;
InTerminator = LF;
ExtraInput = Ignore;
WriteTimeout = ${GLOBAL_TIMEOUT};
ReadTimeout = ${GLOBAL_TIMEOUT};
ReplyTimeout = ${GLOBAL_TIMEOUT};
#
#

######################################################################
# Reset to default state
outRst {
       out "%{|*RST; *WAI}";
}

######################################################################
# Get identification
inIdn {
	out "*IDN?";
	in "%s";
}

######################################################################
# Center Frequency
#
inFrqCent {
    out "FREQ:CENT?";
    in "%f";
}

outFrqCent {
    out "FREQ:CENT %f";
    @init { inFrqCent; };
}

######################################################################
# Frequency Span
#
inFrqSpan {
    out "FREQ:SPAN?";
    in "%f";
}

outFrqSpan {
    out "FREQ:SPAN %f";
    @init { inFrqSpan; };
}

######################################################################
# Start Frequency
#
inFrqStart {
    out "FREQ:STAR?";
    in "%f";
}

outFrqStart {
    out "FREQ:STAR %f";
    @init { inFrqStart; };
}

######################################################################
# Stop Frequency
#
inFrqStop {
    out "FREQ:STOP?";
    in "%f";
}

outFrqStop {
    out "FREQ:STOP %f";
    @init { inFrqStop; };
}

######################################################################
# Reference Level
#
inRefLvl {
    out "DISP:WIND:TRAC:Y:RLEV?";
    in "%f";
}

outRefLvl {
    out "DISP:WIND:TRAC:Y:RLEV %f";
    @init { inRefLvl; };
}
######################################################################
# Reference Level Offset
#
inRefOff {
    out "DISP:WIND:TRAC:Y:RLEV:OFFS?";
    in "%f";
}

outRefOff {
    out "DISP:WIND:TRAC:Y:RLEV:OFFS %f";
    @init { inRefOff; };
}

######################################################################
# Continuous Sweep Mode
#
inSweMode {
    out "INIT:CONT?";
    in "%i";
}

outSweMode {
    out "INIT:CONT %{OFF|ON}";
    @init { inSweMode; };
}
######################################################################
# Sweep Points Number (MIN 101; MAX 32001)
#
inSwePoints {
    out "SWE:POIN?";
    in "%i";
}

outSwePoints {
    out "SWE:POIN %i";
    @init { inSwePoints; };
}

######################################################################
# Auto Adjust Frequency Scale
#
outAutoFreq {
    out "%{|ADJ:FREQ}";
}

######################################################################
# Auto Adjust Level Scale
#
outAutoLvl {
    out "%{|ADJ:LEV}";
}

######################################################################
# Auto Adjust Frequency and Level Scale
#
outAutoAll {
    out "%{|ADJ:ALL}";
}

######################################################################
# Trace Data (single sweep --> INIT:CONT OFF)
#
inTrace {
    Separator=",";
    out "INIT;*WAI";
    out "TRAC? TRACE1";
    in "%E";
}

######################################################################
# Marker X Value
#
inMarkX {
    out "CALC:MARK:X?";
    in "%f";
}

outMarkX {
    out "CALC:MARK:X %f";
    @init { inMarkX; };
}

######################################################################
# Marker Y Value
#
inMarkY {
    out "CALC:MARK:Y?";
    in "%f";
}

######################################################################
# Set Marker to Max Peak on Trace
#
outMarkMax {
    out "%{|CALC:MARK:MAX}";
}

######################################################################
# IQ Data
#
#inIQ {
#    Separator=",";
#    out "INIT:CONT OFF";
#    out "TRAC:IQ:STAT ON";
#    out "TRAC:IQ:SET NORM,10 MHz,32 MHz,IMM,POS,0,10";
#    out "TRAC:IQ:DATA?";
#    in "%E";
#}
