#swee---------------------------------------------------------------------
# Title      : Rohde & Schwarz FSV Signal Analyzer Epics Protocol File
# Project    :
#---------------------------------------------------------------------
# File       : rsfsv.proto
# Author     : Vitor Finotti Ferreira  <vfinotti@finotti-Inspiron-7520>
# Company    : Brazilian Synchrotron Light Laboratory, LNLS/CNPEM
# Created    : 2016-04-05
# Last update: 2016-04-05
# Platform   :
# Standard   : Python 3.4
#---------------------------------------------------------------------
# Description:
#
# Defines protocol to use the device as a StreamDevice IOC in EPICS
#
#---------------------------------------------------------------------
# Copyright (c) 2016 Brazilian Synchrotron Light Laboratory, LNLS/CNPEM
#
# This program is free software: you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public License
# as published by the Free Software Foundation, either version 3 of
# the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this program. If not, see
# <http://www.gnu.org/licenses/>.
#---------------------------------------------------------------------
# Revisions  :
# Date        Version  Author          Description
# 2016-apr-05 1.0      vfinotti        Created
#---------------------------------------------------------------------

######################################################################
#
# Variable declaration
#
GLOBAL_TIMEOUT = 5000;

######################################################################
#
# Communication setup
#
OutTerminator = CR LF;
InTerminator = LF;
ExtraInput = Ignore;
WriteTimeout = ${GLOBAL_TIMEOUT};
ReadTimeout = ${GLOBAL_TIMEOUT};
ReplyTimeout = ${GLOBAL_TIMEOUT};
#
#

######################################################################
# Reset to default state
outRst {
       out "%{|*RST; *WAI}";
}

######################################################################
# Get identification
inIdn {
	out "*IDN?";
	in "%s";
}

######################################################################
# Reference Level
#
inRefLvl {
    out "DISP:WIND:TRAC:Y:RLEV?";
    in "%f";
}

outRefLvl {
    out "DISP:WIND:TRAC:Y:RLEV %f";
    @init { inRefLvl; };
}

######################################################################
# Reference Level Offset
#
inRefOff {
    out "DISP:WIND:TRAC:Y:RLEV:OFFS?";
    in "%f";
}

outRefOff {
    out "DISP:WIND:TRAC:Y:RLEV:OFFS %f";
    @init { inRefOff; };
}

######################################################################
# Continuous Sweep Mode
#
inSweMode {
    out "INIT:CONT?";
    in "%i";
}

outSweMode {
    out "INIT:CONT %{OFF|ON}";
    @init { inSweMode; };
}

######################################################################
# Sweep Points Number (MIN 101; MAX 32001)
#
inSwePoints {
    out "SWE:POIN?";
    in "%i";
}

outSwePoints {
    out "SWE:POIN %i";
    @init { inSwePoints; };
}

######################################################################
# Sweep time

inSweTime {
    out "SENS:SWE:TIME?";
    in "%f";
}

outSweTime {
    out "SENS:SWE:TIME %f";
    @init { inSweTime; };
}

######################################################################
# Enable/Disable automatic coupling of the sweep time to the
# frequency span and bandwidth settings


inEnblSweTimeAuto {
    out "SENS:SWE:TIME:AUTO?";
    in "%i";
}

outEnblSweTimeAuto {
    out "SENS:SWE:TIME:AUTO %{OFF|ON}";
    @init { inEnblSweTimeAuto; };
}

######################################################################
# Resolution Bandwidth

inRbw {
    out "SENS:BWID:RES?";
    in "%i";
}

outRbw {
    out "SENS:BWID:RES %i";
}

######################################################################
# Video Bandwidth

inVbw {
    out "SENS:BWID:VID?";
    in "%i";
}

outVbw {
    out "SENS:BWID:VID %i";
}

######################################################################
# Enable/Disable automatic coupling of the video bandwidth to the
# resolution bandwidth

inEnblVbwAuto {
    out "SENS:BWID:VID:AUTO?";
    in "%i";
}

outEnblVbwAuto {
    out "SENS:BWID:VID:AUTO %{OFF|ON}";
}

######################################################################
# Auto Adjust Frequency Scale
#
outAutoFreq {
    out "%{|ADJ:FREQ}";
}

######################################################################
# Auto Adjust Level Scale
#
outAutoLvl {
    out "%{|ADJ:LEV}";
}

######################################################################
# Auto Adjust Frequency and Level Scale
#
outAutoAll {
    out "%{|ADJ:ALL}";
}

######################################################################
# Trace Data (single sweep --> INIT:CONT OFF)
#
inTrace {
    Separator=",";
    out "INIT;*WAI";
    out "TRAC? TRACE1";
    in "%E";
}

######################################################################
# Center Frequency
#
inFrqCent {
    out "FREQ:CENT?";
    in "%f";
}

outFrqCent {
    out "FREQ:CENT %f";
    @init { inFrqCent; };
}

######################################################################
# Frequency Span
#
inFrqSpan {
    out "FREQ:SPAN?";
    in "%f";
}

outFrqSpan {
    out "FREQ:SPAN %f";
    @init { inFrqSpan; };
}

######################################################################
# Start Frequency
#
inFrqStart {
    out "FREQ:STAR?";
    in "%f";
}

outFrqStart {
    out "FREQ:STAR %f";
    @init { inFrqStart; };
}

######################################################################
# Stop Frequency
#
inFrqStop {
    out "FREQ:STOP?";
    in "%f";
}

outFrqStop {
    out "FREQ:STOP %f";
    @init { inFrqStop; };
}


######################################################################
# Enable Markers (1-4)

inEnblMark1 {
	out "CALC:MARK1:STAT?";
	in "%i";
}

outEnblMark1 {
	out "CALC:MARK1:STAT %i";
	@init { inEnblMark1; };
}

inEnblMark2 {
	out "CALC:MARK2:STAT?";
	in "%i";
}

outEnblMark2 {
	out "CALC:MARK2:STAT %i";
	@init { inEnblMark2; };
}

inEnblMark3 {
	out "CALC:MARK3:STAT?";
	in "%i";
}

outEnblMark3 {
	out "CALC:MARK3:STAT %i";
	@init { inEnblMark3; };
}

inEnblMark4 {
	out "CALC:MARK4:STAT?";
	in "%i";
}

outEnblMark4 {
	out "CALC:MARK4:STAT %i";
	@init { inEnblMark4; };
}

######################################################################
# Markers X Values

inMark1X {
    out "CALC:MARK1:X?";
    in "%f";
}

outMark1X {
    out "CALC:MARK1:X %f";
}

inMark2X {
    out "CALC:MARK2:X?";
    in "%f";
}

outMark2X {
    out "CALC:MARK2:X %f";
}

inMark3X {
    out "CALC:MARK3:X?";
    in "%f";
}

outMark3X {
    out "CALC:MARK3:X %f";
}

inMark4X {
    out "CALC:MARK4:X?";
    in "%f";
}

outMark4X {
    out "CALC:MARK4:X %f";
}

######################################################################
# Markers Y Values

inMark1Y {
    out "CALC:MARK1:Y?";
    in "%f";
}

inMark2Y {
    out "CALC:MARK2:Y?";
    in "%f";
}

inMark3Y {
    out "CALC:MARK3:Y?";
    in "%f";
}

inMark4Y {
    out "CALC:MARK4:Y?";
    in "%f";
}

######################################################################
# Set Marker to Max Peak on Trace

outMarkMax1 {
    out "%{|CALC:MARK1:MAX}";
}

outMarkMax2 {
    out "%{|CALC:MARK2:MAX}";
}

outMarkMax3 {
    out "%{|CALC:MARK3:MAX}";
}

outMarkMax4 {
    out "%{|CALC:MARK4:MAX}";
}

######################################################################
# Input Attenuator Value

inAttIn {
    out "INP:ATT?";
    in "%i";
}

outAttIn {
    out "INP:ATT %i";
}

######################################################################
# Enable/Disable automatic coupling of the input attenuation to the
# reference level

inEnblAttAuto {
    out "INP:ATT:AUTO?";
    in 	"%i";
}

outEnblAttAuto {
    out "INP:ATT:AUTO %{OFF|ON}";
}

######################################################################
# Instruments Nominal input impedance

inImpdIn {
    out "INP:IMP?";
    in "%{50|75}";
}

outImpdIn {
    out "INP:IMP %{50|75}";
}

######################################################################
# Oscillator Reference

inRoscSrc {
    out "SOUR:EXT:ROSC:SOUR?";
    in "%{INT|EXT}";
}

outRoscSrc {
    out "SOUR:EXT:ROSC:SOUR %{INT|EXT}";
}

######################################################################
# IQ Data
#
#inIQ {
#    Separator=",";
#    out "INIT:CONT OFF";
#    out "TRAC:IQ:STAT ON";
#    out "TRAC:IQ:SET NORM,10 MHz,32 MHz,IMM,POS,0,10";
#    out "TRAC:IQ:DATA?";
#    in "%E";
#}
