#!/usr/bin/env bash

set -u

if [ -z "$RSFSV_INSTANCE" ]; then
    echo "RSFSV_INSTANCE environment variable is not set." >&2
    exit 1
fi

export RSFSV_CURRENT_PV_AREA_PREFIX=RSFSV_${RSFSV_INSTANCE}_PV_AREA_PREFIX
export RSFSV_CURRENT_PV_DEVICE_PREFIX=RSFSV_${RSFSV_INSTANCE}_PV_DEVICE_PREFIX
export RSFSV_CURRENT_DEVICE_IP=RSFSV_${RSFSV_INSTANCE}_DEVICE_IP
export RSFSV_CURRENT_DEVICE_TELNET_PORT=RSFSV_${RSFSV_INSTANCE}_TELNET_PORT
# Only works with bash
export RSFSV_PV_AREA_PREFIX=${!RSFSV_CURRENT_PV_AREA_PREFIX}
export RSFSV_PV_DEVICE_PREFIX=${!RSFSV_CURRENT_PV_DEVICE_PREFIX}
export RSFSV_DEVICE_IP=${!RSFSV_CURRENT_DEVICE_IP}
export RSFSV_DEVICE_TELNET_PORT=${!RSFSV_CURRENT_DEVICE_TELNET_PORT}

if [ -z "${RSFSV_CURRENT_DEVICE_TELNET_PORT}" ]; then
    echo "TELNET port is not set." >&2
    exit 1
fi

./runProcServ.sh \
    -t "${RSFSV_DEVICE_TELNET_PORT}" \
    -i "${RSFSV_DEVICE_IP}" \
    -P "${RSFSV_PV_AREA_PREFIX}" \
    -R "${RSFSV_PV_DEVICE_PREFIX}"

